var b=`:host\r
{\r
    display: flex; /* needed for reverse ordering */\r
    flex-direction: column;\r
    overflow: auto;\r
}\r
:host([empty])::before\r
{\r
    content: attr(placeholder);\r
    color: graytext;\r
    font-style: italic;\r
    width: 100%;\r
    height: 100%;\r
    display: flex;\r
    align-items: center;\r
    justify-content: center;\r
}\r
\r
::slotted([data-entry])\r
{\r
    cursor: pointer;\r
    flex-shrink: 0; /* prevents squishing due to the flex display */\r
}\r
\r
::slotted([data-active][data-entry])\r
{\r
    text-decoration: underline;\r
}\r
\r
::slotted([data-entry][data-reversed])\r
{\r
    scale: .98;\r
    opacity: .5;\r
}`;var E=(r=>(r.Create="create",r.Read="read",r.Update="update",r.Delete="delete",r.Custom="custom",r))(E||{});var T="data-reversed",x="data-active",M="data-entry",L="data-timestamp",g=new CSSStyleSheet;g.replaceSync(b);var A="action-history",c=class extends HTMLElement{onBack=async(t,e,i,n,r)=>{};onForward=async(t,e,i,n,r)=>{};get entryAttributeName(){return this.getAttribute("entry-attribute")??M}get activeAttributeName(){return this.getAttribute("active-attribute")??x}get reversedAttributeName(){return this.getAttribute("reversed-attribute")??T}get timestampAttributeName(){return this.getAttribute("timestamp-attribute")??L}#t;#e;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML="<slot></slot>",this.shadowRoot.adoptedStyleSheets.push(g),this.#e=(t=>{let e=this.#t.assignedElements();if(e.length==1&&e[0]instanceof HTMLSlotElement){let i=e[0],n=i.assignedElements();for(;i instanceof HTMLSlotElement&&n[0]instanceof HTMLSlotElement;)i=n[0],i instanceof HTMLSlotElement&&(n=i.assignedElements());this.#i(i);return}this.#n(e)}).bind(this),this.#i(this.shadowRoot.querySelector("slot")),this.addEventListener("click",t=>{let e=t.target.closest(`[${this.entryAttributeName}]`);e!=null&&this.activateEntry(e)})}#i(t){this.#t!=null&&this.#t.removeEventListener("slotchange",this.#e),this.#t=t,this.#t.addEventListener("slotchange",this.#e),this.toggleAttribute("empty",this.#t.assignedElements().length==0)}#n(t){let e=t.find(n=>n.getAttribute(this.activeAttributeName)!=null);e!=null&&e.getAttribute(this.timestampAttributeName)!=null&&(e.removeAttribute(this.activeAttributeName),e=void 0);let i=null;for(let n=0;n<t.length;n++){if(t[n].getAttribute(this.entryAttributeName)==null||(i=t[n],t[n].hasAttribute(this.timestampAttributeName)))continue;let r=t.filter(s=>s.getAttribute("data-reversed")!=null);for(let s=0;s<r.length;s++)r[s].remove();t[n].setAttribute(this.timestampAttributeName,Date.now().toString()),this.updateOrder(t),this.dispatchEvent(new CustomEvent("add",{detail:{target:t[n]},bubbles:!0,composed:!0}))}e==null&&i!=null&&i.getAttribute(this.reversedAttributeName)==null&&i.toggleAttribute(this.activeAttributeName,!0),this.toggleAttribute("empty",t.length==0)}updateOrder(t){if(t=t??this.#t.assignedElements(),this.hasAttribute("reverse"))for(let e=0;e<t.length;e++){let i=t.length-e,n=t[e];n.tabIndex=i,n.style.order=i.toString()}else for(let e=0;e<t.length;e++){let i=t[e];i.removeAttribute("tabindex"),i.style.removeProperty("order")}}back(){let t=this.#t.assignedElements(),e=t.find(r=>r.getAttribute(this.activeAttributeName)!=null);if(e==null)return;let i=t.indexOf(e),n=i-1;if(n==-1){new Promise(async r=>{await this.onBack(e,e,[e],n,i),e.toggleAttribute(this.reversedAttributeName,!0),e.removeAttribute(this.activeAttributeName),r()});return}n>=0&&n<t.length&&t[n].click()}forward(){let t=this.#t.assignedElements(),e=t.find(n=>n.getAttribute(this.activeAttributeName)!=null),i=e==null?t.length>0?0:-1:t.indexOf(e)+1;i!=-1&&i<t.length&&t[i].click()}async activateEntry(t){if(t.hasAttribute(this.activeAttributeName)){this.dispatchEvent(new CustomEvent("refresh",{detail:{target:t},bubbles:!0,composed:!0}));return}let e=await this.#r(t);this.dispatchEvent(new CustomEvent("activate",{detail:e,bubbles:!0,composed:!0}))}async#r(t){let e=this.#t.assignedElements(),i=e.find(l=>l.getAttribute(this.activeAttributeName)!=null);i?.removeAttribute(this.activeAttributeName);let n=e.indexOf(t),r=i==null?-1:e.indexOf(i),s=[],a=[];if(r>n)for(let l=r;l>n;l--)s.push(e[l]);else if(r<n)for(let l=r+1;l<=n;l++)a.push(e[l]);else throw new Error("Unable to determine action");let m={target:t,previousActiveEntry:i,toReverse:s,toActivate:a,targetIndex:n,previousActiveEntryIndex:r};if(s.length>0){for(let u=0;u<s.length;u++)s[u].toggleAttribute(this.reversedAttributeName,!0);let l=s[s.length-1];await this.onBack(l,i,s,e.indexOf(l),r)}else if(a.length>0){for(let u=0;u<a.length;u++)a[u].removeAttribute(this.reversedAttributeName);let l=a[a.length-1];await this.onForward(l,i,a,e.indexOf(l),r)}return t.toggleAttribute(this.activeAttributeName,!0),m}async reverseEntry(t){if(t.hasAttribute(this.reversedAttributeName))return;let e=this.#t.assignedElements(),i=e.find(o=>o.getAttribute(this.activeAttributeName)!=null);i?.removeAttribute(this.activeAttributeName);let n=e.indexOf(t),r=i==null?-1:e.indexOf(i),s=[t],a=[];if(n==r){await this.onBack(t,t,[t],n,r),t.toggleAttribute(this.reversedAttributeName,!0),t.removeAttribute(this.activeAttributeName);let d=e.findIndex(f=>f.dataset.timestamp==t.dataset.timestamp)-1,v=d<0||d>e.length-1?void 0:e[d];v?.toggleAttribute(this.activeAttributeName,!0),this.dispatchEvent(new CustomEvent("reverse",{detail:{target:t,previousActiveEntry:i,toReverse:s,toActivate:a,targetIndex:n,previousActiveEntryIndex:r},bubbles:!0,composed:!0}));return}if(r>n)for(let o=r;o>n;o--)s.push(e[o]);else if(r<n)for(let o=r+1;o<=n;o++)a.push(e[o]);else throw new Error("Unable to determine action");let m={target:t,previousActiveEntry:i,toReverse:s,toActivate:a,targetIndex:n,previousActiveEntryIndex:r};if(s.length>0){for(let d=0;d<s.length;d++)s[d].toggleAttribute(this.reversedAttributeName,!0);let o=s[s.length-1];await this.onBack(o,i,s,e.indexOf(o),r)}else if(a.length>0){for(let d=0;d<a.length;d++)a[d].removeAttribute(this.reversedAttributeName);let o=a[a.length-1];await this.onForward(o,i,a,e.indexOf(o),r)}let u=e.findIndex(o=>o.dataset.timestamp==t.dataset.timestamp)-1,h=u<0||u>e.length-1?void 0:e[u];h?.toggleAttribute(this.activeAttributeName,!0),t.removeAttribute(this.activeAttributeName),this.dispatchEvent(new CustomEvent("reverse",{detail:m,bubbles:!0,composed:!0}))}static observedAttributes=["reverse"];attributeChangedCallback(t,e,i){t=="reverse"&&this.updateOrder()}};customElements.get(A)==null&&customElements.define(A,c);export{x as ATTRIBUTENAME_ACTIVE,M as ATTRIBUTENAME_ENTRY,T as ATTRIBUTENAME_REVERSED,L as ATTRIBUTENAME_TIMESTAMP,c as ActionHistoryElement,E as HistoryEntryType};
