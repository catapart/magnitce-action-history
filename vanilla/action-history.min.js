var b=`:host\r
{\r
    display: flex; /* needed for reverse ordering */\r
    flex-direction: column;\r
    overflow: auto;\r
}\r
:host([empty])::before\r
{\r
    content: attr(placeholder);\r
    color: graytext;\r
    font-style: italic;\r
    width: 100%;\r
    height: 100%;\r
    display: flex;\r
    align-items: center;\r
    justify-content: center;\r
}\r
\r
::slotted([data-entry])\r
{\r
    cursor: pointer;\r
    flex-shrink: 0; /* prevents squishing due to the flex display */\r
}\r
\r
::slotted([data-active][data-entry])\r
{\r
    text-decoration: underline;\r
}\r
\r
::slotted([data-entry][data-reversed])\r
{\r
    scale: .98;\r
    opacity: .5;\r
}`;var E=(n=>(n.Create="create",n.Read="read",n.Update="update",n.Delete="delete",n.Custom="custom",n))(E||{});var T="data-reversed",x="data-active",M="data-entry",L="data-timestamp",g=new CSSStyleSheet;g.replaceSync(b);var A="action-history",c=class extends HTMLElement{onBack=async(e,t,i,r,n)=>{};onForward=async(e,t,i,r,n)=>{};get entryAttributeName(){return this.getAttribute("entry-attribute")??M}get activeAttributeName(){return this.getAttribute("active-attribute")??x}get reversedAttributeName(){return this.getAttribute("reversed-attribute")??T}get timestampAttributeName(){return this.getAttribute("timestamp-attribute")??L}#t;#e;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML="<slot></slot>",this.shadowRoot.adoptedStyleSheets.push(g),this.#e=(e=>{let t=this.#t.assignedElements();if(t.length==1&&t[0]instanceof HTMLSlotElement){let i=t[0],r=i.assignedElements();for(;i instanceof HTMLSlotElement&&r[0]instanceof HTMLSlotElement;)i=r[0],i instanceof HTMLSlotElement&&(r=i.assignedElements());this.#i(i);return}this.#n(t)}).bind(this),this.#i(this.shadowRoot.querySelector("slot")),this.addEventListener("click",e=>{let t=e.target.closest(`[${this.entryAttributeName}]`);t!=null&&this.activateEntry(t)})}#i(e){this.#t!=null&&this.#t.removeEventListener("slotchange",this.#e),this.#t=e,this.#t.addEventListener("slotchange",this.#e);let t=this.#t.assignedElements();this.toggleAttribute("empty",t.length==0),this.#n(t)}#n(e){let t=e.find(n=>n.getAttribute(this.activeAttributeName)!=null);t!=null&&t.getAttribute(this.timestampAttributeName)!=null&&(t.removeAttribute(this.activeAttributeName),t=void 0);let i=this.getAttribute("prevent-removal")==null,r=null;for(let n=0;n<e.length;n++)if(e[n].getAttribute(this.entryAttributeName)!=null&&(r=e[n],!e[n].hasAttribute(this.timestampAttributeName))){if(i==!0){let a=e.filter(s=>s.getAttribute(this.reversedAttributeName)!=null);for(let s=0;s<a.length;s++)a[s].remove()}e[n].setAttribute(this.timestampAttributeName,Date.now().toString()),this.updateOrder(e),this.dispatchEvent(new CustomEvent("add",{detail:{target:e[n]},bubbles:!0,composed:!0}))}t==null&&r!=null&&r.getAttribute(this.reversedAttributeName)==null&&r.toggleAttribute(this.activeAttributeName,!0),this.toggleAttribute("empty",e.length==0)}updateOrder(e){if(e=e??this.#t.assignedElements(),this.hasAttribute("reverse"))for(let t=0;t<e.length;t++){let i=e.length-t,r=e[t];r.tabIndex=i,r.style.order=i.toString()}else for(let t=0;t<e.length;t++){let i=e[t];i.removeAttribute("tabindex"),i.style.removeProperty("order")}}back(){let e=this.#t.assignedElements(),t=e.find(n=>n.getAttribute(this.activeAttributeName)!=null);if(t==null)return;let i=e.indexOf(t),r=i-1;if(r==-1){new Promise(async n=>{await this.onBack(t,t,[t],r,i),t.toggleAttribute(this.reversedAttributeName,!0),t.removeAttribute(this.activeAttributeName),n()});return}r>=0&&r<e.length&&e[r].click()}forward(){let e=this.#t.assignedElements(),t=e.find(r=>r.getAttribute(this.activeAttributeName)!=null),i=t==null?e.length>0?0:-1:e.indexOf(t)+1;i!=-1&&i<e.length&&e[i].click()}async activateEntry(e){if(e.hasAttribute(this.activeAttributeName)){this.dispatchEvent(new CustomEvent("refresh",{detail:{target:e},bubbles:!0,composed:!0}));return}let t=await this.#r(e);this.dispatchEvent(new CustomEvent("activate",{detail:t,bubbles:!0,composed:!0}))}async#r(e){let t=this.#t.assignedElements(),i=t.find(l=>l.getAttribute(this.activeAttributeName)!=null);i?.removeAttribute(this.activeAttributeName);let r=t.indexOf(e),n=i==null?-1:t.indexOf(i),a=[],s=[];if(n>r)for(let l=n;l>r;l--)a.push(t[l]);else if(n<r)for(let l=n+1;l<=r;l++)s.push(t[l]);else throw new Error("Unable to determine action");let m={target:e,previousActiveEntry:i,toReverse:a,toActivate:s,targetIndex:r,previousActiveEntryIndex:n};if(a.length>0){for(let u=0;u<a.length;u++)a[u].toggleAttribute(this.reversedAttributeName,!0);let l=a[a.length-1];await this.onBack(l,i,a,t.indexOf(l),n)}else if(s.length>0){for(let u=0;u<s.length;u++)s[u].removeAttribute(this.reversedAttributeName);let l=s[s.length-1];await this.onForward(l,i,s,t.indexOf(l),n)}return e.toggleAttribute(this.activeAttributeName,!0),m}async reverseEntry(e){if(e.hasAttribute(this.reversedAttributeName))return;let t=this.#t.assignedElements(),i=t.find(o=>o.getAttribute(this.activeAttributeName)!=null);i?.removeAttribute(this.activeAttributeName);let r=t.indexOf(e),n=i==null?-1:t.indexOf(i),a=[e],s=[];if(r==n){await this.onBack(e,e,[e],r,n),e.toggleAttribute(this.reversedAttributeName,!0),e.removeAttribute(this.activeAttributeName);let d=t.findIndex(f=>f.dataset.timestamp==e.dataset.timestamp)-1,v=d<0||d>t.length-1?void 0:t[d];v?.toggleAttribute(this.activeAttributeName,!0),this.dispatchEvent(new CustomEvent("reverse",{detail:{target:e,previousActiveEntry:i,toReverse:a,toActivate:s,targetIndex:r,previousActiveEntryIndex:n},bubbles:!0,composed:!0}));return}if(n>r)for(let o=n;o>r;o--)a.push(t[o]);else if(n<r)for(let o=n+1;o<=r;o++)s.push(t[o]);else throw new Error("Unable to determine action");let m={target:e,previousActiveEntry:i,toReverse:a,toActivate:s,targetIndex:r,previousActiveEntryIndex:n};if(a.length>0){for(let d=0;d<a.length;d++)a[d].toggleAttribute(this.reversedAttributeName,!0);let o=a[a.length-1];await this.onBack(o,i,a,t.indexOf(o),n)}else if(s.length>0){for(let d=0;d<s.length;d++)s[d].removeAttribute(this.reversedAttributeName);let o=s[s.length-1];await this.onForward(o,i,s,t.indexOf(o),n)}let u=t.findIndex(o=>o.dataset.timestamp==e.dataset.timestamp)-1,h=u<0||u>t.length-1?void 0:t[u];h?.toggleAttribute(this.activeAttributeName,!0),e.removeAttribute(this.activeAttributeName),this.dispatchEvent(new CustomEvent("reverse",{detail:m,bubbles:!0,composed:!0}))}static observedAttributes=["reverse"];attributeChangedCallback(e,t,i){e=="reverse"&&this.updateOrder()}};customElements.get(A)==null&&customElements.define(A,c);export{x as ATTRIBUTENAME_ACTIVE,M as ATTRIBUTENAME_ENTRY,T as ATTRIBUTENAME_REVERSED,L as ATTRIBUTENAME_TIMESTAMP,c as ActionHistoryElement,E as HistoryEntryType};
